---
id: typeorm-helper
title: TypeORM Helper
---

TypeORM is an ORM that can run in NodeJS, Browser, Cordova, PhoneGap, Ionic, React Native, NativeScript, Expo, and Electron platforms and can be used with TypeScript and JavaScript (ES5, ES6, ES7, ES8. 

## TypeORM Facility

TypeORM uses different way on defining decorators, so without further step its impossible for Plumier to get type information of the entity decorated with TypeORM decorators, which will be problem if you want to use your entity as your DTO. 

Plumier provided Facility to automatically transform your TypeORM decorated entity so it can be used by Plumier.

```typescript
new Plumier()
    .set(new WebApiFacility())
    .set(new TypeORMFacility({ /* TypeORM configuration */ }))
    .initialize()
``` 

Using above configuration, its now possible to use entity as the DTO like below

```typescript
import { Entity, Column, PrimaryGeneratedColumn, getManager } from "typeorm"
import { TypeORMFacility } from "@plumier/typeorm"
import { WebApiFacility } from "plumier"

@Entity()
export class User {
    @PrimaryGeneratedColumn()
    id: number
    
    @Column()
    @val.email()
    email: string

    @Column()
    name: string

    @Column()
    password: string

    @Column()
    role: "User" | "Admin"
}

export class UsersController {
    private readonly repo: Repository<User>

    constructor() {
        this.repo = getManager().getRepository(User)
    }

    @route.post("")
    save(data: User) {
        return this.repo.save(data)
    }

    @route.get(":id")
    get(id: number) {
        return this.repo.findOne(id)
    }

    @route.put(":id")
    modify(id: number, data: User) {
        return this.repo.update(id, data)
    }

    @route.delete(":id")
    delete(id: number) {
        return this.repo.delete(id)
    }
}
```

## CRUD Route Generator
Plumier provided facility to automatically generate routes from your entity, Plumier uses [tinspector](https://github.com/plumier/tinspector) reflection to create generic CRUD controller on the fly. Routes generated based entity name and generate Restful route below:

| Route                     | Description    |
| ------------------------- | -------------- |
| `GET /users?offset&limit` | List of users  |
| `GET /users/:id`          | Get user by id |
| `POST /users`             | Add user       |
| `PUT /users/:id`          | Modify user    |
| `PATCH /users/:id`        | Modify user    |
| `DELETE /users/:id`       | Delete user    |

If you have entity with one to many relation, Plumier will create nested Restful route for them like below

```typescript
@Entity()
class User {
    @OneToMany(x => Phone, /* relation config */)
    phones: Phone[]
}
```

| Route                                      | Description          |
| ------------------------------------------ | -------------------- |
| `GET /users/:parentId/phones?offset&limit` | List of users phone  |
| `GET /users/:parentId/phones/:id`          | Get user phone by id |
| `POST /users/:parentId/phones`             | Add user phone       |
| `PUT /users/:parentId/phones/:id`          | Modify user phone    |
| `PATCH /users/:parentId/phones/:id`        | Modify user phone    |
| `DELETE /users/:parentId/phones/:id`       | Delete user phone    |


To be able to generate routes from entity you need to use `CRUDTypeORMFacility` like below

```typescript
new Plumier()
    .set(new WebApiFacility())
    .set(new JwtAuthFacility()) 
    .set(new CRUDTypeORMFacility({ /* TypeORM configuration */ }))
    .initialize()
```

### Override Action 
Generic CRUD controller provide common functionalities to perform CRUD to database, you can override one of each route generated by providing a controller. 

TypeORM CRUD Route generator respect the [route overridable strategy](/extends/custom-route-generator#control-duplicate-routes) so any controller created match with route http method and path will automatically override the route.

```typescript
@Entity()
class User {
    @PrimaryGeneratedColumn()
    id:number
    @Column()
    name:string
}
```

Above entity will have 6 routes generated, you can override any of the 6 route by creating a controller handle the route match with its Http Method and Path like below. 

```typescript
@route.root("users")
class OverriddenUserController {
    @route.get("") // /users?offset&limit&name
    get(offset:number, limit:number, name:string){}
}
```

Above controller will automatically override the `get /users?offset&limit` into `get /users?offset&limit&name`, note that only http method and path used to ID the overridden process.